@page "/maps"
@using GoogleMapsComponents
@using GoogleMapsComponents.Maps
@using System.Diagnostics

@inject IJSRuntime JsRuntime

<h1>Maps</h1>

<div ref="@map1ElementRef" Id="map1" style="height: 500px"></div>
<GoogleMap ref="@map2" Id="map2" Options="@mapOptions2"></GoogleMap>

<button onclick="@SyncBounds">Sync map bounds</button>
<button onclick="@SyncMapCenter">Sync map center</button>
<button onclick="@SetMapHeading">Set map heading</button>
<button onclick="@ToggleMapType">Toggle map type</button>
<button onclick="@ToggleTilt">Toggle map tilt</button>
<button onclick="@ZoomIn">Zoom in</button>

@functions {
    private Map map1;
    private GoogleMap map2;

    private MapOptions mapOptions;
    private MapOptions mapOptions2;

    private ElementRef map1ElementRef;

    protected override void OnInit()
    {
        mapOptions = new MapOptions()
        {
            Zoom = 13,
            Center = new LatLngLiteral()
            {
                Lat = 13.505892,
                Lng = 100.8162
            },
            MapTypeId = MapTypeId.Roadmap
        };

        mapOptions2 = new MapOptions()
        {
            Zoom = 18,
            Center = new LatLngLiteral()
            {
                Lat = 45.518,
                Lng = -122.672
            },
            MapTypeId = MapTypeId.Sattellite,
            Heading = 90,
            Tilt = 45
        };
    }

    protected override async Task OnAfterRenderAsync()
    {
        if(map1 == null)
        {
            map1 = await Map.CreateAsync(JsRuntime, map1ElementRef, mapOptions);

            Debug.WriteLine("Init finished");
        }

        //if (OnAfterInit != null)
        //{
        //    OnAfterInit();
        //}
    }

    private async Task SyncBounds()
    {
        var bounds = await map1.GetBounds();
        await map2.InteropObject.FitBounds(bounds);
    }

    private async Task SyncMapCenter()
    {
        var latLng = await map1.GetCenter();
        await map2.InteropObject.SetCenter(latLng);
    }

    private async Task SetMapHeading()
    {
        await map2.InteropObject.SetHeading(await map2.InteropObject.GetHeading() + 90);
        var heading = await map2.InteropObject.GetHeading();

        Console.WriteLine($"Map2 heading is {heading}");
    }

    private async Task ToggleTilt()
    {
        var tilt = await map2.InteropObject.GetTilt();

        Console.WriteLine($"Map2 tilt is {tilt}");

        if (tilt > 0)
        {
            await map2.InteropObject.SetTilt(0);
        }
        else
        {
            await map2.InteropObject.SetTilt(45);
        }
    }

    private async Task ZoomIn()
    {
        var zoom = await map1.GetZoom();
        await map1.SetZoom(zoom + 1);
    }

    private async Task ToggleMapType()
    {
        var mapTypeId = await map1.GetMapTypeId();

        Console.WriteLine($"Map type is {mapTypeId}");

        if (mapTypeId != MapTypeId.Sattellite)
        {
            await map1.SetMapTypeId(MapTypeId.Sattellite);
        }
        else
        {
            await map1.SetMapTypeId(MapTypeId.Roadmap);
        }
    }
}